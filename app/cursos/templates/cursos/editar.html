{% extends "base.html" %}
{% block title %}Editar Curso — BBS{% endblock %}

{% block content %}
<div class="container py-4 fade-in">
  <div class="card shadow-lg border-0">
    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">
        <i class="fas fa-pen-to-square me-2"></i> Editar curso: {{ curso.nombre }}
      </h4>
      <a href="{{ url_for('cursos.detalle', curso_id=curso.id) }}" class="btn btn-outline-light btn-sm">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </a>
    </div>

    <div class="card-body">
      <form method="POST">
        {{ form.hidden_tag() }}

        <!-- === Información básica del curso === -->
        <div class="row">
          <div class="col-md-6 mb-3">
            {{ form.nombre.label(class="form-label fw-bold") }}
            {{ form.nombre(class="form-control", placeholder="Nombre del curso") }}
            {% for error in form.nombre.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="col-md-3 mb-3">
            {{ form.tipo.label(class="form-label fw-bold") }}
            {{ form.tipo(class="form-select") }}
            {% for error in form.tipo.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>

          <div class="col-md-3 mb-3">
            {{ form.horas_totales.label(class="form-label fw-bold") }}
            {{ form.horas_totales(class="form-control", placeholder="Horas totales") }}
            {% for error in form.horas_totales.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>
        </div>

        <div class="row">
          <div class="col-md-3 mb-3">
            {{ form.horas_semanales.label(class="form-label fw-bold") }}
            {{ form.horas_semanales(class="form-control", placeholder="Horas semanales") }}
            {% for error in form.horas_semanales.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>
        </div>

        <hr class="my-4">

        <!-- === Módulos del curso === -->
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="text-success fw-bold mb-0"><i class="fas fa-layer-group me-2"></i>Módulos del curso</h5>
          <button type="button" class="btn btn-outline-success btn-sm" id="add-module-btn">
            <i class="fas fa-plus"></i> Agregar módulo
          </button>
        </div>

        <div id="modules-container">
          {% for subform in form.modulos %}
            <div class="module-card border rounded p-3 mb-3 bg-light">
              <div class="row">
                <div class="col-md-6 mb-3">
                  {{ subform.nombre.label(class="form-label fw-bold") }}
                  {{ subform.nombre(class="form-control", placeholder="Nombre del módulo") }}
                </div>
                <div class="col-md-3 mb-3">
                  {{ subform.horas_modulo.label(class="form-label fw-bold") }}
                  {{ subform.horas_modulo(class="form-control", placeholder="Horas del módulo") }}
                </div>
                <div class="col-md-3 mb-3">
                  {{ subform.docente_nombre.label(class="form-label fw-bold") }}
                  {{ subform.docente_nombre(class="form-control", placeholder="Docente responsable") }}
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  {{ subform.temario.label(class="form-label fw-bold") }}
                  {{ subform.temario(class="form-control", rows="2", placeholder="Temario o contenidos") }}
                </div>
                <div class="col-md-3 mb-3">
                  {{ subform.anio_fp.label(class="form-label fw-bold") }}
                  {{ subform.anio_fp(class="form-select") }}
                </div>
                <div class="col-md-3 mb-3">
                  {{ subform.semestre_fp.label(class="form-label fw-bold") }}
                  {{ subform.semestre_fp(class="form-select") }}
                </div>
              </div>

              <div class="text-end">
                <button type="button" class="btn btn-outline-danger btn-sm remove-module-btn">
                  <i class="fas fa-trash"></i> Eliminar módulo
                </button>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="text-end mt-4">
          {{ form.submit(class="btn btn-success px-5 py-2") }}
        </div>
      </form>
    </div>
  </div>
</div>

<!-- === Script para añadir/eliminar módulos dinámicamente === -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const addButton = document.getElementById('add-module-btn');
  const container = document.getElementById('modules-container');

  if (addButton) {
    addButton.addEventListener('click', () => {
      const count = container.children.length;
      const newModule = document.createElement('div');
      newModule.classList.add('module-card', 'border', 'rounded', 'p-3', 'mb-3', 'bg-light');
      newModule.innerHTML = `
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Nombre del módulo</label>
            <input class="form-control" name="modulos-${count}-nombre" required placeholder="Nombre del módulo">
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label fw-bold">Horas del módulo</label>
            <input class="form-control" name="modulos-${count}-horas_modulo" type="number" min="1" required>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label fw-bold">Docente</label>
            <input class="form-control" name="modulos-${count}-docente_nombre" placeholder="Docente responsable">
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Temario</label>
            <textarea class="form-control" name="modulos-${count}-temario" rows="2"></textarea>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label fw-bold">Año (FP)</label>
            <select class="form-select" name="modulos-${count}-anio_fp">
              <option value="">—</option>
              <option value="1">1º</option>
              <option value="2">2º</option>
            </select>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label fw-bold">Semestre (FP)</label>
            <select class="form-select" name="modulos-${count}-semestre_fp">
              <option value="">—</option>
              <option value="1">1º</option>
              <option value="2">2º</option>
            </select>
          </div>
        </div>
        <div class="text-end">
          <button type="button" class="btn btn-outline-danger btn-sm remove-module-btn">
            <i class="fas fa-trash"></i> Eliminar módulo
          </button>
        </div>`;
      container.appendChild(newModule);
    });
  }

  container.addEventListener('click', (e) => {
    if (e.target.closest('.remove-module-btn')) {
      e.target.closest('.module-card').remove();
    }
  });
});
</script>
{% endblock %}
