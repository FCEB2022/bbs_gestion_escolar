{% extends "base.html" %}
{% block title %}Programar Curso — BBS{% endblock %}

{% block content %}
<div class="container py-4 fade-in">

  <div class="card shadow-lg border-0">
    <div class="card-header d-flex justify-content-between align-items-center" style="background-color:#198754; color:white;">
      <h4 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Programar Curso</h4>
      <a href="{{ url_for('cursos.detalle', curso_id=curso.id) }}" class="btn btn-outline-light btn-sm">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </a>
    </div>

    <form method="POST">
      {{ form.hidden_tag() }}
      <div class="card-body">

        <h5 class="fw-bold text-success mb-3">{{ curso.nombre }}</h5>

        {% if curso.tipo == 'FP' %}
          <div class="row g-3">

            <div class="col-md-12">
              {{ form.anio_escolar_inicio.label(class="form-label fw-semibold") }}
              {{ form.anio_escolar_inicio(class="form-control", placeholder="Ej.: 2025-2026") }}
              <div class="form-text">Introduce el año escolar inicial con formato <strong>YYYY-YYYY</strong>. El final se calcula automáticamente.</div>
            </div>

            <div class="col-md-6">
              {{ form.fecha_inicio_anio1.label(class="form-label fw-semibold") }}
              {{ form.fecha_inicio_anio1(class="form-control") }}
              <div class="form-text">Seleccione la fecha de inicio del primer año.</div>
            </div>
            <div class="col-md-6">
              {{ form.fecha_inicio_anio2.label(class="form-label fw-semibold") }}
              {{ form.fecha_inicio_anio2(class="form-control") }}
              <div class="form-text">Seleccione la fecha de inicio del segundo año.</div>
            </div>

          </div>
        {% else %}
          <!-- Intensivo: tu form de intensivo tal cual -->
          <div class="row g-3">
            <div class="col-md-6">
              {{ form.fecha_inicio.label(class="form-label fw-semibold") }}
              {{ form.fecha_inicio(class="form-control") }}
              <div class="form-text">Fecha de inicio del curso intensivo.</div>
            </div>
          </div>
        {% endif %}

        <div class="text-end mt-4">
          <button class="btn btn-success px-4">Guardar programación</button>
        </div>

      </div>
    </form>
  </div>

  {% if semanas_por_mes %}
  <div class="card shadow-sm border-0 mt-5">
    <div class="card-header bg-light">
      <h5 class="mb-0 text-success"><i class="fas fa-calendar-week me-2"></i>Previsualización del calendario</h5>
    </div>
    <div class="card-body">
      <div class="calendar-grid">
        {% for mes, semanas in semanas_por_mes.items() %}
          <div class="month-block shadow-sm">
            <h6 class="month-title">{{ mes }}</h6>
            <div class="weeks-grid">
              {% for inicio, fin in semanas %}
                <div class="week-card">
                  <strong>Semana {{ loop.index }}</strong><br>
                  <small>{{ inicio.strftime('%d/%m') }} - {{ fin.strftime('%d/%m') }}</small>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

</div>

<style>
  .calendar-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; }
  .month-block { background:#f8f9fa; border-radius:10px; padding:1rem; border:1px solid #dee2e6; }
  .month-title { color:#198754; font-weight:600; margin-bottom:1rem; }
  .week-card { background:linear-gradient(135deg,#e9f7ef,#d1f0dc); border-radius:8px; padding:.6rem; text-align:center; box-shadow:0 1px 3px rgba(0,0,0,.1); }
</style>
{% endblock %}
